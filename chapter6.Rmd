# **RStudio Exercise 6: Analysis of Longitudinal Data**

\  
```{r include=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(psych)
```
First we will open all the required data files. (For detailed documentation how the data was created see: [https://github.com/ohwhalme/IODS-project/blob/master/data/meet_and_repeat.R](https://github.com/ohwhalme/IODS-project/blob/master/data/meet_and_repeat.R))
```{r}
BPRS <- read.csv("C:/Users/OHW/Desktop/R/IODS-project/data/BPRS.csv")
BPRS <- select(BPRS, -X)
BPRSL <- read.csv("C:/Users/OHW/Desktop/R/IODS-project/data/BPRSL.csv")
BPRSL <- select(BPRSL, -X)
RATS <- read.csv("C:/Users/OHW/Desktop/R/IODS-project/data/RATS.csv")
RATS <- select(RATS, -X)
RATSL <- read.csv("C:/Users/OHW/Desktop/R/IODS-project/data/RATSL.csv")
RATSL <- select(RATSL, -X)
BPRS$treatment <- factor(BPRS$treatment)
BPRS$subject <- factor(BPRS$subject)
RATS$ID <- factor(RATS$ID)
RATS$Group <- factor(RATS$Group)
RATSL$ID <- factor(RATSL$ID)
RATSL$Group <- factor(RATSL$Group)
```
Then we will proceed to "Implement the analyses of Chapter 8 of MABS using the RATS data".
\  

\  

#### **Comparing long and wide form of RATS**:
```{r}
glimpse(RATS)
head(RATS)
tail(RATS)
glimpse(RATSL)
head(RATSL)
tail(RATSL)
```
The wide form consist of 16 observations and 13 variables and the long form of 176 observations and 5 variables. As explained earlier (see above the link for how the data was created), in the data set we have 16 rats who have been assigned to 3 different experimental groups (diet) and their weight have been followed for 9 weeks. Wide form represents each individual on single row and the measurement points (WD1 to WD64) as separate variables. In the long form each participant is stacked on top of each other 11 times (reflecting the number of measurement points) and each days outcome (grams) are recoded into single variable.
\  

\  

#### **Presenting RATS visually and standardizing the data**:
```{r}
p1 <- ggplot(RATSL, aes(x = Time, y = Weight, linetype = ID))
p2 <- p1 + geom_line() + scale_linetype_manual(values = rep(1:10, times=4))
p3 <- p2 + facet_grid(. ~ Group, labeller = label_both)
p4 <- p3 + theme_bw() + theme(legend.position = "none")
p5 <- p4 + theme(panel.grid.minor.y = element_blank())
p6 <- p5 + scale_y_continuous(limits = c(min(RATSL$Weight), max(RATSL$Weight)))
p6
```
\  

Above we have plotted the 8 rats from group 1, 4 rats from group 2, and 4 rats from group 3 across the 9 week time period. On y-axis we have assigned rats weight on grams. We can infer that the group 1 is considerably lighter from base line to end of the trial than the groups 2 and 3 (i.e. rats were smaller to begin with in group 1). There seems to exist slight upwards trend in all of the groups indicating that the rats are gaining weight as the trial goes on. There does not seem to be great differences in the variability of individual rats weight across time, although the intercepts do differ quite much (in group 2 there is especially notable deviation in the intercept).
\  

Next, we will standardize the outcome values (grouped by time: Weight - mean(Weight))/sd(Weight)) and create the same plot.
```{r}
RATSL <- RATSL %>%
  group_by(Time) %>%
  mutate( stdWeight = (Weight - mean(Weight))/sd(Weight) ) %>%
  ungroup()
glimpse(RATSL)

p1 <- ggplot(RATSL, aes(x = Time, y = stdWeight, linetype = ID))
p2 <- p1 + geom_line() + scale_linetype_manual(values = rep(1:10, times=4))
p3 <- p2 + facet_grid(. ~ Group, labeller = label_both)
p4 <- p3 + theme_bw() + theme(legend.position = "none")
p5 <- p4 + theme(panel.grid.minor.y = element_blank())
p6 <- p5 + scale_y_continuous(name = "standardized Weight")
p6
```

Now "Weight" has mean of 0 and standard deviation of 1 on each measurement point (time). This highlights the fact that different individuals have different intercepts on "Weight". Because the standardation was grouped by time, the trends look somewhat different when compared to the first plot (standardization was mainly done to better show the "tracking" phenomenon, not so much to interpret the results).
\  

Next we will plot mean response profiles for the 3 dietary groups.
```{r}
n <- RATSL$Time %>% unique() %>% length()

RATSS <- RATSL %>%
  group_by(Group, Time) %>%
  summarise(mean = mean(Weight), se = sd(Weight)/sqrt(n) ) %>%
  ungroup()
glimpse(RATSS)

p1 <- ggplot(RATSS, aes(x = Time, y = mean, linetype = Group, shape = Group))
p2 <- p1 + geom_line() + scale_linetype_manual(values = c(1:3))
p3 <- p2 + geom_point(size=3) + scale_shape_manual(values = c(1:3))
p4 <- p3 + geom_errorbar(aes(ymin=mean-se, ymax=mean+se, linetype="1"), width=0.3)
p5 <- p4 + theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
p6 <- p5 + theme(legend.position = c(0.98,0.5))
p7 <- p6 + scale_y_continuous(name = "mean(Weight) +/- se(Weight)")
p7
```


